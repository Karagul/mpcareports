---
title: "Our Project: Environmental Analysis"
subtitle: "We may have done something great here"
date:  'Last updated: `r format(Sys.Date(), "%Y-%m-%d")`'
author: "Yihui Xie & Rachel Carson | MPCA"
output:
  tint::tintPdf: 
    toc: true
    toc_depth: 1
bibliography: skeleton.bib
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(message=F, warning=F)
```


# Summary

`r tint::newthought("The goal")` of this project is to identify the four Pokemon^[Pokemon are a new invasive species in MN. See [Pokemen explosion in MN](https://en.wikipedia.org/wiki/Pok%C3%A9mon).] that are polluting the local stream and causing it to glow purple on several occasions, documented on the following dates:

- `July 12, 2020`
- `July 18, 2020`
- `July 23, 2020`


## Project details

> Where?
>
> Who?
> 
> What is contributing most?
>


# Data sources

All data were downloaded from the following online resources:

1. US EPA
1. Wikipedia
1. BBC.org

```{r, message=F, warning=F, eval=F}
library(tidyverse)

# Download data
data <- read_csv("")

```


## Facility IDs pulled from MPCA's local TEMPO database. 

We used the `mpcadb` package to access TEMPO.

```{r mpcadb}
library(mpcadb)

## TEMPO AI's
# Complete list of the Agency Interest names from TEMPO with `get_ai()`.
ai_names <- get_ai(ai = c(1:8, 56, 878), keep_alt_names = T)

knitr::kable(head(ai_names))

```


<br>

## _(help!)_ Access data from MN's GIS Rest API

## _(help!)_ Read data from blackholes: PDF's, Excel, Access 

<br>

# Data dictionary  
  
| Column  |  Description   |  Example value      |
|:-|:---|:---|
|`geoid` |  Unique ID assigned to each Pokemon.      |  _`2430262`_ |    
|`lat  ` |  Latitude coordinate of object's center.  | _`-94.021`_  |   
|`lon  ` |  Longitude coordinate of object's center. |  _`44.521`_  | 

# Data overview

```{r, include=F}
knitr::kable(mtcars[1:6, 1:6], caption = 'A subset of mtcars.')
```

To place figures in the margin you can use the **knitr** chunk option `fig.margin = TRUE`.

For example:

`{r fig-margin, fig.margin=T, fig.cap="MPG vs Horsepower, colored by transmission."}`

```{r fig-margin, fig.margin = TRUE, fig.cap = "**FIG 1.**   MPG vs horsepower, colored by transmission.", fig.width=3.5, fig.height=3.5, cache=TRUE, warning=F, message=F}
library(ggplot2)
library(mncolors)

mtcars <- mtcars

mtcars$Transmission <- factor(mtcars$am, 
                              labels = c('automatic', 'manual'))

ggplot(mtcars, aes(hp, mpg, color = Transmission)) +
  geom_point() + 
  geom_smooth() +
  scale_color_mn(palette = "accent", reverse = T) +
  theme(legend.position = 'top')
```

</br>




## MN Colors

You can set the colors for your plots to align with the MN state brand:
```{r set-colors}
library(mncolors) #remotes::install_github("MPCA-data/mncolors")
library(ggplot2)
#library(hrbrthemes)

mpca_theme <- function() {
 
  title_color   <- mncolors(5, "blue")[5]

  caption_color <- mncolors(5, "blue")[2]
 
  theme(plot.title   = element_text(color = title_color),
             plot.caption = element_text(color = caption_color, face  = 'bold'))
  
}

ggplot(diamonds, aes(carat, price)) +
  geom_smooth(aes(color = cut), size = 1.5, show.legend = F) +
  scale_color_mn(palette = "treefrog") +
  facet_wrap(vars(cut), nrow = 1) +
  labs(title    = "Increasing cost of cleanups",
       subtitle = "Brownfield site classifications",
       caption  = "Source: EPA Data Mart 2018") +
  #scale_y_comma() +
  mpca_theme()
```


# Analysis

```{marginfigure}

We used the following equation to scale the Pokemon contribution to its relative size and spatial distribution in the watershed:
  
  
  for $x$ in $[a, b]$:
$$\frac{d}{dx}\left( \int_{a}^{x} f(u)\,du\right)=f(x)$$
```


# A map to guide you
```{r full-map, fig.width=10, fig.height=5, fig.fullwidth=T, fig.cap="Federally recognized tribal areas in Minnesota. _Ref. MPCA Geocommons..._", warning=F, message=F}
library(mpcaej) #remotes::install_github("MPCA-data/mpcaej")
library(leaflet)
library(sf)
library(tidyverse)

ej_shapes    <- ej_shapes

tribal_areas <- tribe_shapes

#------ Map the polygons ---------#
leaflet(st_transform(tribal_areas, 4326)) %>%
  addProviderTiles(providers$Stamen.TonerLines,
                   options = providerTileOptions) %>%
  addProviderTiles(providers$CartoDB.Voyager,
                   options = providerTileOptions(opacity = 0.8)) %>%
  addPolygons(color        = "purple",
              weight       = 1,
              smoothFactor = 1.4,
              opacity      = 0.9,
              fillOpacity  = 0.2) 
```


# Tab menus {.tabset .tabset-pills}

You can condense a group of related material into a tabbed menu the reader can select from. For example, several maps of your project. Add ` {.tabset}` after the main header _( ` # My tab menu {.tabset} ` )_ for the group, and then every sub-header _( ` ## The first tab ` )_ under it will be collapsed into a new tab.


## Map markers

```{r, fig.width=7, fig.height=4}

sites <- read_csv('https://raw.githubusercontent.com/MPCA-air/aqi-watch/master/data-raw/locations.csv')

sites <- filter(sites, str_detect(`Site Name`, "Paul"))

# Add site markers
leaflet(sites) %>%
  addProviderTiles(providers$CartoDB) %>%
  addMarkers()
```


## Add popups 

```{r, fig.width=7, fig.height=4}
# Add popup info & Darkness
leaflet(sites) %>%
  addProviderTiles(providers$CartoDB) %>%
  addMarkers(popup = ~`Site Name`)
```

## Dark basemap 

```{r, fig.width=7, fig.height=4}
# Add Darkness
leaflet(sites) %>%
  addProviderTiles(providers$CartoDB.DarkMatter) %>%
  addMarkers(popup = ~`Site Name`)
```


## Circle markers
```{r, fig.width=7, fig.height=4}
# Add Darkness
leaflet(sites) %>%
  addProviderTiles(providers$CartoDB.DarkMatter) %>%
  addCircleMarkers(label = ~`Site Name`)
```


## Label a single site
```{r, fig.width=8, fig.height=5}
# Add Darkness
leaflet(sites) %>%
  addProviderTiles(providers$CartoDB.DarkMatter) %>%
  addCircleMarkers(label = ~`Site Name`) %>%
  addCircleMarkers(data   = sites[4, ],
                   color  = "hotpink",
                   radius = 15,
                   label  = ~`Site Name`,
                   labelOptions = labelOptions(noHide = T, 
                                               textsize = "15px"))
```


# Collapsible / Hidden content

Want to hide a long list or table until the reader chooses to look at it? You can use `<summary>` for that. Adding the following creates a drop-down window in your document that will start collapsed and expand when the reader clicks on it.


```md
<details>
<summary> Click to see the Loooooong list </summary>

 ...this is hidden, collapsable content...

- fish
- bird
- toad
- stone
 
</details>
```


__And here it is:__

---

<details>
<summary> Click to see the Loooooong list </summary>
 
 ...this is hidden, collapsable content...

- fish
- bird
- toad
- stone


</details>

---

# _(help!)_ Non-detect and Censored data summaries

# _(help!)_ Multi-variate predictions

# Conclusions

You can set figures to span the entire page by using the chunk option `fig.fullwidth = TRUE`.

```{r fig-fullwidth, fig.width=10, fig.height=2, fig.fullwidth=T, fig.cap = "A full width figure.", warning=F, message=F, cache=T}
ggplot(diamonds, aes(carat, price)) + geom_smooth() +
  facet_grid(~ cut)
```


This comment says it best:

> _I can win an argument on any topic, against any opponent. People know this, and steer clear of me at parties. Often, as a sign of their great respect, they don't even invite me._
>
> `r tint::quote_footer('--- Dave Barry')`


# References

1. 2012, A
1. 2015, B
1. 2018, C



```{r bib, include=F}
# KEEP THIS AT THE END OF THE DOCUMENT TO GENERATE A LOCAL bib FILE FOR PKGS USED
knitr::write_bib(sub("^package:", "", grep("package", search(), value=TRUE)),
                 file='skeleton.bib')
```

